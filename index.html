<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeSpark | Utility Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap');
        .font-mono {
            font-family: 'Roboto Mono', monospace;
        }
        .gradient-text {
            background: linear-gradient(to right, #ca8a04, #854d0e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .app-tab.active {
            border-color: #ca8a04;
            background-color: #fefce8;
            color: #ca8a04;
        }
        .app-content {
            display: none;
        }
        .app-content.active {
            display: block;
        }
        /* To-Do List Specific Styles */
        .todo-item.completed span {
            text-decoration: line-through;
            color: #9ca3af;
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 antialiased">

    <div id="customModal" class="modal">
        <div class="modal-content text-center">
            <div id="modalMessage" class="text-gray-900 font-medium mb-6"></div>
            <button id="modalCloseBtn" class="bg-amber-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-amber-700 transition-colors duration-200 w-full">OK</button>
        </div>
    </div>

    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-2xl md:text-3xl font-bold text-stone-800 text-center">CodeSpark <span class="gradient-text">Utility Hub</span></h1>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 py-8">
        <div class="mb-8 overflow-x-auto">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-2 sm:space-x-4" aria-label="Tabs">
                    <button class="app-tab active whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-amber-600 hover:border-amber-300 transition-colors" data-tab="quiz">Quiz Game</button>
                    <button class="app-tab whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-amber-600 hover:border-amber-300 transition-colors" data-tab="todo">To-Do List</button>
                    <button class="app-tab whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-amber-600 hover:border-amber-300 transition-colors" data-tab="countdown">Countdown</button>
                    <button class="app-tab whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-amber-600 hover:border-amber-300 transition-colors" data-tab="weather">Weather</button>
                    <button class="app-tab whitespace-nowrap py-4 px-2 sm:px-4 border-b-2 font-medium text-sm text-gray-500 hover:text-amber-600 hover:border-amber-300 transition-colors" data-tab="tip">Tip Calculator</button>
                </nav>
            </div>
        </div>

        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-stone-200">
            
            <section id="quiz" class="app-content active">
                <div id="quiz-container" class="max-w-2xl mx-auto">
                    <div id="quiz-start-screen">
                        <h2 class="text-2xl font-bold text-center mb-4">General Knowledge Quiz</h2>
                        <p class="text-center text-stone-600 mb-6">Test your knowledge. You'll get 10 questions to answer.</p>
                        <button id="quiz-start-btn" class="w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-700 transition-colors">Start Quiz</button>
                    </div>
                    <div id="quiz-game-screen" class="hidden">
                        <div class="flex justify-between items-center mb-4">
                            <p class="text-sm font-medium">Score: <span id="quiz-score">0</span></p>
                            <p class="text-sm font-medium">Question <span id="quiz-question-number">1</span> of <span id="quiz-total-questions">10</span></p>
                        </div>
                        <h3 id="quiz-question" class="text-xl font-semibold mb-6 text-center"></h3>
                        <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>
                    <div id="quiz-end-screen" class="hidden text-center">
                        <h2 class="text-3xl font-bold mb-4">Quiz Complete!</h2>
                        <p class="text-xl text-stone-600 mb-2">Your Final Score is</p>
                        <p id="quiz-final-score" class="text-6xl font-bold gradient-text mb-8"></p>
                        <button id="quiz-restart-btn" class="w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-700 transition-colors">Play Again</button>
                    </div>
                </div>
            </section>

            <section id="todo" class="app-content">
                 <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold text-center mb-6">My To-Do List</h2>
                    <form id="todo-form" class="flex gap-3 mb-6">
                        <input type="text" id="todo-input" placeholder="Add a new task..." class="flex-grow block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500" required>
                        <button type="submit" class="bg-amber-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-amber-700 transition-colors">Add</button>
                    </form>
                    <ul id="todo-list" class="space-y-3">
                        </ul>
                </div>
            </section>

            <section id="countdown" class="app-content">
                <div class="max-w-2xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4">Event Countdown Timer</h2>
                    <p class="text-stone-600 mb-6">Select a future date and time to start the countdown.</p>
                    <div class="flex flex-col sm:flex-row gap-3 mb-6">
                        <input type="datetime-local" id="countdown-datetime" class="flex-grow block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 p-2">
                        <button id="countdown-start-btn" class="bg-amber-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-amber-700 transition-colors">Start</button>
                    </div>
                    <div id="countdown-display" class="grid grid-cols-4 gap-2 sm:gap-4 text-center">
                        <div><p id="countdown-days" class="font-bold text-4xl md:text-6xl">00</p><span class="text-sm text-stone-500">Days</span></div>
                        <div><p id="countdown-hours" class="font-bold text-4xl md:text-6xl">00</p><span class="text-sm text-stone-500">Hours</span></div>
                        <div><p id="countdown-minutes" class="font-bold text-4xl md:text-6xl">00</p><span class="text-sm text-stone-500">Minutes</span></div>
                        <div><p id="countdown-seconds" class="font-bold text-4xl md:text-6xl">00</p><span class="text-sm text-stone-500">Seconds</span></div>
                    </div>
                </div>
            </section>

            <section id="weather" class="app-content">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold text-center mb-6">Live Weather Forecast</h2>
                    <form id="weather-form" class="flex gap-3 mb-6">
                        <input type="text" id="weather-city-input" placeholder="Enter a city name..." class="flex-grow block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500" required>
                        <button type="submit" class="bg-amber-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-amber-700 transition-colors">Get</button>
                    </form>
                    <div id="weather-result" class="hidden bg-stone-100 p-6 rounded-lg text-center">
                        <h3 id="weather-city-name" class="text-3xl font-bold"></h3>
                        <div class="flex items-center justify-center">
                            <img id="weather-icon" src="" alt="Weather icon" class="w-24 h-24">
                            <p id="weather-temp" class="text-5xl font-bold"></p>
                        </div>
                        <p id="weather-desc" class="text-stone-600 text-lg capitalize"></p>
                    </div>
                </div>
            </section>

            <section id="tip" class="app-content">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold text-center mb-8">Tip & Bill Split Calculator</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="tip-bill" class="block text-sm font-medium text-gray-700">Bill Amount</label>
                            <input type="number" id="tip-bill" min="0" step="0.01" placeholder="0.00" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500">
                        </div>
                        <div>
                            <label for="tip-percentage" class="block text-sm font-medium text-gray-700">Tip Percentage</label>
                             <input type="range" id="tip-percentage" min="0" max="100" value="15" class="mt-1 block w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                             <p class="text-center font-semibold mt-2"><span id="tip-percentage-value">15</span>%</p>
                        </div>
                        <div>
                            <label for="tip-people" class="block text-sm font-medium text-gray-700">Number of People</label>
                            <input type="number" id="tip-people" min="1" step="1" value="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500">
                        </div>
                    </div>
                    <div class="mt-8 pt-6 border-t-2 border-dashed border-stone-200 grid grid-cols-2 gap-4 text-center">
                        <div>
                            <p class="text-sm text-stone-500">Tip Amount</p>
                            <p id="tip-amount" class="text-3xl font-bold text-amber-600">$0.00</p>
                        </div>
                        <div>
                            <p class="text-sm text-stone-500">Total Per Person</p>
                            <p id="tip-total" class="text-3xl font-bold text-amber-600">$0.00</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="bg-stone-100 mt-12">
        <div class="container mx-auto px-6 py-6 text-center text-stone-600">
            <p class="text-sm">&copy; 2025 Nikhil Kumar & Team | Utility Hub. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Global App Navigation ---
        const tabs = document.querySelectorAll('.app-tab');
        const contents = document.querySelectorAll('.app-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const target = tab.getAttribute('data-tab');
                
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                contents.forEach(content => {
                    if (content.id === target) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            });
        });

        // --- Custom Modal Logic ---
        const customModal = document.getElementById('customModal');
        const modalMessage = document.getElementById('modalMessage');
        const modalCloseBtn = document.getElementById('modalCloseBtn');
        const showModal = (message) => {
            modalMessage.textContent = message;
            customModal.style.display = 'flex';
        };
        modalCloseBtn.addEventListener('click', () => {
            customModal.style.display = 'none';
        });

        // --- 1. Quiz Game Logic (updated) ---
        const quizStartScreen = document.getElementById('quiz-start-screen');
        const quizGameScreen = document.getElementById('quiz-game-screen');
        const quizEndScreen = document.getElementById('quiz-end-screen');
        const startBtn = document.getElementById('quiz-start-btn');
        const restartBtn = document.getElementById('quiz-restart-btn');
        const questionEl = document.getElementById('quiz-question');
        const optionsEl = document.getElementById('quiz-options');
        const scoreEl = document.getElementById('quiz-score');
        const questionNumEl = document.getElementById('quiz-question-number');
        const totalQuestionsEl = document.getElementById('quiz-total-questions');
        const finalScoreEl = document.getElementById('quiz-final-score');
        
        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;

        async function startQuiz() {
            try {
                quizStartScreen.classList.add('hidden');
                quizGameScreen.classList.add('hidden'); // Hide game screen while loading
                showModal("Loading questions...");

                const response = await fetch('https://opentdb.com/api.php?amount=10&type=multiple');
                const data = await response.json();
                if (data.response_code !== 0) {
                    throw new Error("Failed to fetch questions. Please try again.");
                }
                quizQuestions = data.results;
                totalQuestionsEl.textContent = quizQuestions.length;

                customModal.style.display = 'none'; // Hide modal after loading
                quizGameScreen.classList.remove('hidden');

                currentQuestionIndex = 0;
                score = 0;
                showQuestion();

            } catch (error) {
                showModal(error.message);
                quizStartScreen.classList.remove('hidden');
            }
        }

        function showQuestion() {
            scoreEl.textContent = score;
            questionNumEl.textContent = currentQuestionIndex + 1;
            const currentQuestion = quizQuestions[currentQuestionIndex];
            
            // Use decodeURIComponent to display special characters correctly
            questionEl.innerHTML = decodeHtml(currentQuestion.question);

            const options = [...currentQuestion.incorrect_answers, currentQuestion.correct_answer];
            options.sort(() => Math.random() - 0.5);

            optionsEl.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.innerHTML = decodeHtml(option);
                button.className = "w-full text-left p-4 border-2 border-stone-200 rounded-lg hover:bg-stone-100 transition-colors";
                button.addEventListener('click', () => selectAnswer(option, button));
                optionsEl.appendChild(button);
            });
        }

        function selectAnswer(selectedAnswer, button) {
            const correctAnswer = quizQuestions[currentQuestionIndex].correct_answer;
            const correct = selectedAnswer === correctAnswer;

            if (correct) {
                score += 10;
                button.classList.add('bg-green-200', 'border-green-400');
            } else {
                button.classList.add('bg-red-200', 'border-red-400');
                Array.from(optionsEl.children).forEach(btn => {
                    if (btn.textContent === decodeHtml(correctAnswer)) {
                        btn.classList.add('bg-green-200', 'border-green-400');
                    }
                });
            }

            Array.from(optionsEl.children).forEach(btn => btn.disabled = true);

            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizQuestions.length) {
                    showQuestion();
                } else {
                    endQuiz();
                }
            }, 1000);
        }

        function endQuiz() {
            quizGameScreen.classList.add('hidden');
            quizEndScreen.classList.remove('hidden');
            finalScoreEl.textContent = score;
        }

        // Helper function to decode HTML entities from the API
        function decodeHtml(html) {
            const txt = document.createElement("textarea");
            txt.innerHTML = html;
            return txt.value;
        }

        startBtn.addEventListener('click', startQuiz);
        restartBtn.addEventListener('click', () => {
            quizEndScreen.classList.add('hidden');
            startQuiz();
        });


        // --- 2. To-Do List Logic ---
        const todoForm = document.getElementById('todo-form');
        const todoInput = document.getElementById('todo-input');
        const todoList = document.getElementById('todo-list');
        let todos = JSON.parse(localStorage.getItem('todos')) || [];

        function renderTodos() {
            todoList.innerHTML = '';
            todos.forEach((todo, index) => {
                const li = document.createElement('li');
                li.className = `todo-item flex items-center justify-between p-3 bg-stone-100 rounded-lg ${todo.completed ? 'completed' : ''}`;
                li.innerHTML = `
                    <span class="flex-grow mr-4 break-all">${todo.text}</span>
                    <div class="flex items-center gap-2 flex-shrink-0">
                        <button class="toggle-btn p-1 text-green-500 hover:text-green-700">✓</button>
                        <button class="delete-btn p-1 text-red-500 hover:text-red-700">✗</button>
                    </div>
                `;
                li.querySelector('.toggle-btn').addEventListener('click', () => toggleTodo(index));
                li.querySelector('.delete-btn').addEventListener('click', () => deleteTodo(index));
                todoList.appendChild(li);
            });
        }

        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
        }

        function addTodo(e) {
            e.preventDefault();
            const text = todoInput.value.trim();
            if (text) {
                todos.push({ text: text, completed: false });
                todoInput.value = '';
                saveTodos();
                renderTodos();
            }
        }
        
        function toggleTodo(index) {
            todos[index].completed = !todos[index].completed;
            saveTodos();
            renderTodos();
        }

        function deleteTodo(index) {
            todos.splice(index, 1);
            saveTodos();
            renderTodos();
        }
        
        todoForm.addEventListener('submit', addTodo);
        renderTodos();
        
        // --- 3. Countdown Timer Logic ---
        const datetimeInput = document.getElementById('countdown-datetime');
        const startCountdownBtn = document.getElementById('countdown-start-btn');
        let countdownInterval;

        startCountdownBtn.addEventListener('click', () => {
            const targetDate = new Date(datetimeInput.value).getTime();
            if (isNaN(targetDate)) {
                showModal("Please select a valid date and time.");
                return;
            }

            clearInterval(countdownInterval);

            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = targetDate - now;
                const display = document.getElementById('countdown-display');

                if (distance < 0) {
                    clearInterval(countdownInterval);
                     display.innerHTML = '<p class="col-span-4 text-2xl font-bold text-amber-600">Event has started!</p>';
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('countdown-days').textContent = String(days).padStart(2, '0');
                document.getElementById('countdown-hours').textContent = String(hours).padStart(2, '0');
                document.getElementById('countdown-minutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('countdown-seconds').textContent = String(seconds).padStart(2, '0');

            }, 1000);
        });

        // --- 4. Weather App Logic ---
        const weatherForm = document.getElementById('weather-form');
        const cityInput = document.getElementById('weather-city-input');
        const weatherResult = document.getElementById('weather-result');
        
        weatherForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const city = cityInput.value.trim();
            if (!city) return;

            const url = `https://wttr.in/${city}?format=j1`;
            const submitButton = weatherForm.querySelector('button');
            const originalButtonText = submitButton.textContent;
            submitButton.textContent = '...';
            submitButton.disabled = true;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('City not found or weather service is unavailable.');
                }
                
                const data = await response.json();
                
                const condition = data.current_condition[0];
                const area = data.nearest_area[0];

                document.getElementById('weather-city-name').textContent = `${area.areaName[0].value}, ${area.country[0].value}`;
                document.getElementById('weather-temp').textContent = `${condition.temp_C}°C`;
                document.getElementById('weather-desc').textContent = condition.weatherDesc[0].value;
                
                // Fix for mixed content: force HTTPS for the icon URL
                const iconUrl = condition.weatherIconUrl[0].value;
                document.getElementById('weather-icon').src = iconUrl.startsWith('http:') ? iconUrl.replace('http:', 'https:') : iconUrl;
                
                weatherResult.classList.remove('hidden');

            } catch (error) {
                showModal(error.message);
                weatherResult.classList.add('hidden');
            } finally {
                submitButton.textContent = originalButtonText;
                submitButton.disabled = false;
            }
        });


        // --- 5. Tip Calculator Logic ---
        const billInput = document.getElementById('tip-bill');
        const tipPercentageInput = document.getElementById('tip-percentage');
        const tipPercentageValue = document.getElementById('tip-percentage-value');
        const peopleInput = document.getElementById('tip-people');
        const tipAmountEl = document.getElementById('tip-amount');
        const totalPerPersonEl = document.getElementById('tip-total');

        function calculateTip() {
            const bill = parseFloat(billInput.value);
            const tipPercentage = parseInt(tipPercentageInput.value);
            const people = parseInt(peopleInput.value);

            tipPercentageValue.textContent = tipPercentage;

            if (isNaN(bill) || isNaN(people) || bill < 0 || people < 1) {
                tipAmountEl.textContent = '$0.00';
                totalPerPersonEl.textContent = '$0.00';
                return;
            }

            const tipAmount = bill * (tipPercentage / 100);
            const total = bill + tipAmount;
            const totalPerPerson = total / people;
            
            tipAmountEl.textContent = `$${tipAmount.toFixed(2)}`;
            totalPerPersonEl.textContent = `$${totalPerPerson.toFixed(2)}`;
        }

        [billInput, tipPercentageInput, peopleInput].forEach(input => {
            input.addEventListener('input', calculateTip);
        });

    });
    </script>
</body>
</html>